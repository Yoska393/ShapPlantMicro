---
title: "60_1 MetRF_Analysis"
author: "Hayato Yoshioka"
date: "2023-11-29"
output: html_document
---


For the rm model discription 60 to onajininaru kamo..

```{r, message =F}
require(BGLR)
require(here)
library(foreach)
```

#Inner 
#Drought 

#RF hist

```{r}
set<- readRDS(here("out", paste0("yPredMet_RF_", "W4", ".RDS")))
```

correlation
```{r}
accu <- NULL
for(i in 1:length(set)) {
  dat <- set[[i]]
  accu <- rbind(accu, cor(dat[,1], dat[,-1]))
}
colnames(accu) <- c("G_RF", "Micro_RF", "G+Micro_RF")
rownames(accu) <- names(set)
accu1<- accu 
```

```{r, fig.asp = 1}
pairs(accu)

pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "coral")
        abline(0, 1, col = "darkgreen")
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```

draw histogram

```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,90),col="coral")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```


get predicted and observed values 

```{r}
pred <- vector("list", 4)
names(pred) <- c("G", "Micro", "G+Micro", "obs")
for(i in 1:length(set)) {
  dat <- set[[i]]
  for(j in 1:3) {
    pred[[j]] <- cbind(pred[[j]], dat[,j + 1])
  }
  pred[[4]] <- 
    cbind(pred[[4]], dat[, 1])
}
for(i in 1:4) {
  rownames(pred[[i]]) <- rownames(set[[1]])
  colnames(pred[[i]]) <- names(set)
}
```

save predicted values

```{r}
saveRDS(pred, here("out", paste0("19f19_predMet_RF_OneOut", "_W4", ".RDS")))
```



# BLUPHist

```{r}
getwd()

obs<- pred[["obs"]]
myvector <- c(
  "19f19_predmet_G_blup_OneOut.csv",
  "19f19_predmet_M_blup_OneOut.csv",
  "19f19_predmet_GM_blup_OneOut.csv"
)

co<- foreach(i = 1:3,.combine = cbind) %do% {
  cs<-read.csv(paste0("out/",myvector[i]), row.names = 1)
  correlation <- cor(cs, obs)
  correlation_diag <- diag(correlation)
return(correlation_diag)
}
colnames(co)<- c("G_BLUP", "Micro_BLUP", "G+Micro_BLUP")

accu<-co
accu2<- accu 
```

```{r, fig.asp = 1}
pairs(accu)

pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "coral")
        abline(0, 1, col = "darkgreen")
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```


```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,90),col="coral")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```

# Integrate Pair
```{r, fig.asp = 1}
pairs(cbind(accu2,accu1),cex=0.5)
pairs(cbind(accu2, accu1),
      lower.panel = function(x, y) {
        points(x, y, cex = 0.5,col = "coral")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 2)
      })
```


#  Control

# RF hist
```{r}
set<- readRDS(here("out", paste0("yPredMet_RF_", "W1", ".RDS")))
```


correlation
```{r}
accu <- NULL
for(i in 1:length(set)) {
  dat <- set[[i]]
  accu <- rbind(accu, cor(dat[,1], dat[,-1]))
}
colnames(accu) <- c("G_RF", "Micro_RF", "G+Micro_RF")
rownames(accu) <- names(set)
accu1<- accu 
```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```

draw histogram

```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,90),col="cornflowerblue")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```



get predicted and observed values 

```{r}
pred <- vector("list", 4)
names(pred) <- c("G", "Micro", "G+Micro", "obs")
for(i in 1:length(set)) {
  dat <- set[[i]]
  for(j in 1:3) {
    pred[[j]] <- cbind(pred[[j]], dat[,j + 1])
  }
  pred[[4]] <- 
    cbind(pred[[4]], dat[, 1])
}
for(i in 1:4) {
  rownames(pred[[i]]) <- rownames(set[[1]])
  colnames(pred[[i]]) <- names(set)
}
```

save predicted values

```{r}
saveRDS(pred, here("out", paste0("19f19_predMet_RF_OneOut", "_W1", ".RDS")))
```



# BLUPHist

```{r}
getwd()

obs<- pred[["obs"]]
myvector <- c(
  "19f19_predmet_G_blup_OneOut_c.csv",
  "19f19_predmet_M_blup_OneOut_c.csv",
  "19f19_predmet_GM_blup_OneOut_c.csv"
)

co<- foreach(i = 1:3,.combine = cbind) %do% {
  cs<-read.csv(paste0("out/",myvector[i]), row.names = 1)
  correlation <- cor(cs, obs)
  correlation_diag <- diag(correlation)
return(correlation_diag)
}
colnames(co)<- c("G_BLUP", "Micro_BLUP", "G+Micro_BLUP")

accu<-co
accu2<- accu 
```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```


```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,90),col="cornflowerblue")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```
```{r, fig.asp = 1}
pairs(cbind(accu2,accu1),cex=0.5)
pairs(cbind(accu2, accu1),
      lower.panel = function(x, y) {
        points(x, y, cex = 0.5,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 2)
      })
```


# Inter

# Drought 

# RF hist
```{r}
set<- readRDS(here("out", paste0("yPredMet_RF_", "W4", "19f20",".RDS")))
```

correlation
```{r}
accu <- NULL
for(i in 1:length(set)) {
  dat <- set[[i]]
  accu <- rbind(accu, cor(dat[,1], dat[,-1]))
}
colnames(accu) <- c("G_RF_Inter", "Micro_RF_inter", "G+Micro_RF_Inter")
rownames(accu) <- names(set)
accu1<- accu
```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "coral")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```

draw histogram

```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,120),col="coral")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```

get predicted and observed values 

```{r}
pred <- vector("list", 4)
names(pred) <- c("G", "Micro", "G+Micro", "obs")
for(i in 1:length(set)) {
  dat <- set[[i]]
  for(j in 1:3) {
    pred[[j]] <- cbind(pred[[j]], dat[,j + 1])
  }
  pred[[4]] <- 
    cbind(pred[[4]], dat[, 1])
}
for(i in 1:4) {
  rownames(pred[[i]]) <- rownames(set[[1]])
  colnames(pred[[i]]) <- names(set)
}

```

save predicted values

```{r}
saveRDS(pred, here("out", paste0("19f20_predMet_RF_OneOut", "_W4", ".RDS")))
```


# BLUPHist

```{r}
getwd()

obs<- pred[["obs"]]
myvector <- c(
  "19f20_predmet_G_blup_OneOut.csv",
  "19f20_predmet_M_blup_OneOut.csv",
  "19f20_predmet_GM_blup_OneOut.csv"
)

co<- foreach(i = 1:3,.combine = cbind) %do% {
  cs<-read.csv(paste0("out/",myvector[i]), row.names = 1)
  correlation <- cor(cs, obs)
  correlation_diag <- diag(correlation)
return(correlation_diag)
}
colnames(co)<- c("G_BLUP_Inter", "Micro_BLUP_Inter", "G+Micro_BLUP_Inter")

accu<-co
accu2<- accu 

```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "coral")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })

```


```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,120),col="coral")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```
# Integrate Pair
```{r, fig.asp = 1}
pairs(cbind(accu2,accu1),cex=0.5)
pairs(cbind(accu2, accu1),
      lower.panel = function(x, y) {
        points(x, y, cex = 0.5,col = "coral")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 2)
      })
```


# Control

# RF hist
```{r}
set<- readRDS(here("out", paste0("yPredMet_RF_", "W1", "19f20",".RDS")))
```

correlation
```{r}
accu <- NULL
for(i in 1:length(set)) {
  dat <- set[[i]]
  accu <- rbind(accu, cor(dat[,1], dat[,-1]))
}
colnames(accu) <- c("G_RF_Inter", "Micro_RF_inter", "G+Micro_RF_Inter")
rownames(accu) <- names(set)
accu1<- accu
```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })
```

draw histogram

```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,120),col="cornflowerblue")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```

get predicted and observed values 

```{r}
pred <- vector("list", 4)
names(pred) <- c("G", "Micro", "G+Micro", "obs")
for(i in 1:length(set)) {
  dat <- set[[i]]
  for(j in 1:3) {
    pred[[j]] <- cbind(pred[[j]], dat[,j + 1])
  }
  pred[[4]] <- 
    cbind(pred[[4]], dat[, 1])
}
for(i in 1:4) {
  rownames(pred[[i]]) <- rownames(set[[1]])
  colnames(pred[[i]]) <- names(set)
}

```

save predicted values

```{r}
saveRDS(pred, here("out", paste0("19f20_predMet_RF_OneOut", "_W1", ".RDS")))
```


# BLUPHist

```{r}
getwd()

obs<- pred[["obs"]]
myvector <- c(
  "19f20_predmet_G_blup_OneOut_c.csv",
  "19f20_predmet_M_blup_OneOut_c.csv",
  "19f20_predmet_GM_blup_OneOut_c.csv"
)

co<- foreach(i = 1:3,.combine = cbind) %do% {
  cs<-read.csv(paste0("out/",myvector[i]), row.names = 1)
  correlation <- cor(cs, obs)
  correlation_diag <- diag(correlation)
return(correlation_diag)
}
colnames(co)<- c("G_BLUP_inter", "Micro_BLUP_inter", "G+Micro_BLUP_inter")

accu<-co
accu2<- accu 

```

```{r, fig.asp = 1}
pairs(accu)
pairs(accu,
      lower.panel = function(x, y) {
        points(x, y, cex = 1.0,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 3)
      })

```


```{r, fig.asp = 1}
op <- par(mfrow = c(3, 1))
for(i in 1:ncol(accu)) {
  hist(accu[,i], main = paste(toupper(colnames(accu)[i]), "model"),
       breaks = seq(-1.0, 1.0, 0.1),xlab="COR",ylim = c(0,120),col="cornflowerblue")
  abline(v = median(accu[,i]),                       # Add line for mean
       col = "darkgreen",
       lwd = 3)  
  legend(x = "topright", # location of legend within plot area
  c("Median"),
  col = c("darkgreen"),
    lwd = c(2, 2, 2))
  
}
par(op)
```
# Integrate Pair
```{r, fig.asp = 1}
pairs(cbind(accu2,accu1),cex=0.5)
pairs(cbind(accu2, accu1),
      lower.panel = function(x, y) {
        points(x, y, cex = 0.5,col = "cornflowerblue")
        abline(0, 1, col = "darkgreen")
        
      },
      upper.panel = function(x, y) {
        # 相関係数を計算
        r <- round(cor(x, y), 2)
        # テキストの位置と相関係数を描画
        text(mean(range(x)), mean(range(y)), labels = paste0("r = ", r), cex = 2)
      })
```
